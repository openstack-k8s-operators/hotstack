<!--
// Assisted by watsonx Code Assistant
// Code generated by WCA@IBM in this programming language is not approved for
// use in IBM product development.
-->
# Cloud images

This Makefile automates the process of downloading and customizing a CentOS 9
Stream controller image, as well as creating a blank image file. The tasks are
executed using the `make` utility, and the default task is to perform both
operations.

## Variables

- `CONTROLLER_IMAGE_URL`: The URL to download the CentOS 9 Stream controller
  image.
- `CONTROLLER_IMAGE_NAME`: The name of the downloaded image file.
- `CONTROLLER_INSTALL_PACKAGES`: A list of packages to install on the
  controller image.
- `BLANK_IMAGE_NAME`: The name of the blank image file to be created.
- `BLANK_IMAGE_SIZE`: The size of the blank image file in megabytes.

## Targets

- `all`: The default target that depends on both `controller` and `blank`.
- `clean`: A target that removes both the controller and blank images.
- `controller`: A target that depends on `controller_download` and
  `controller_customize`.
  - `controller_download`: A target that downloads the controller image from
    the specified URL.
  - `controller_customize`: A target that customizes the downloaded image by
    installing the specified packages and relabeling SELinux.
  - `controller_clean`: A target that removes the controller image file.
- `blank`: A target that creates a blank image file of the specified size.
- `blank_clean`: A target that removes the blank image file.

## Examples

### Cleanup

```shell
make clean
```

### Building and uploading the controller image to glance

1. Build the controller image:

   ```shell
   make controller
   ```

2. Upload the controller image to Glance:

   ```shell
   openstack image create --disk-format qcow2 --file controller.qcow2 hotstack-controller
   ```

### Building and uploading the blank image to glance

1. Create the blank image:

   ```shell
   make blank
   ```

2. Upload the blank image to Glance:

   ```shell
   openstack image create --disk-format qcow2 --file blank-image.qcow2 sushy-tools-blank-image \
     --property hw_firmware_type=uefi \
     --property hw_machine_type=q35 \
     --property os_shutdown_timeout=5
   ```
