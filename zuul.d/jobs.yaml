---
- job:
    name: hotstack-pre-commit
    nodeset: hotstack-pod
    description: |
      Run pre-commit in pod
    timeout: 450
    run: ci/playbooks/pre-commit.yml

- job:
    name: vexxhost-hotstack-ipxe-image
    parent: base-hotstack-ixpe-image-periodic
    nodeset: hotstack-image-vexxhost
    description: |
      Build Hotstack ipxe image
    timeout: 900
    vars:
      cloud_name: vexxhost
    files:
      - ^ipxe/.*

- job:
    name: vexxhost-hotstack-blank-image
    parent: base-hotstack-blank-image-periodic
    nodeset: hotstack-image-vexxhost
    description: |
      Build Hotstack blank image
    timeout: 900
    vars:
      cloud_name: vexxhost
    files:
      - ^images/.*

- job:
    name: vexxhost-hotstack-controller-image
    parent: base-hotstack-controller-image-periodic
    nodeset: hotstack-image-vexxhost
    description: |
      Build Hotstack controller image
    timeout: 900
    vars:
      cloud_name: vexxhost
    files:
      - ^images/.*

- job:
    name: vexxhost-hotstack-sno-2-bm
    parent: base-hotstack
    nodeset: hotstack-image-vexxhost
    description: |
      Hotstack scenario: sno-2-bm
    timeout: 10800
    attempts: 1
    vars:
      cloud_name: vexxhost
      scenario: sno-2-bm
      scenario_dir: >-
        {{
          [
            ansible_user_dir,
            zuul.projects['github.com/openstack-k8s-operators/hotstack'].src_dir,
            'scenarios'
          ] | ansible.builtin.path_join
        }}
      hotstack_overrides:
        stack_parameters:
          controller_params:
            image: hotstack-controller
            # vpu: 1 ram 2GB disk: 20GB
            flavor: ci.m1.small
          ocp_master_params:
            image: ipxe-boot-usb
            # vpu: 16 ram 48GB disk: 200GB
            flavor: 16vcpu_48GB
          ironic_params:
            image: cs9stream-genericcloud
            cd_image: sushy-tools-blank-image
            # vpu: 1 ram 2GB disk: 20GB
            flavor: ci.m1.small
            # vpu: 2 ram 4GB disk: 40GB
            # flavor: ci.m1.medium
          cdrom_disk_bus: sata
    run:
      - ci/playbooks/run-deploy.yml
      - ci/playbooks/run-tests.yml
    files:
      - ^scenarios/sno-2-bm/.*

- job:
    name: vexxhost-hotstack-3-nodes
    parent: base-hotstack
    nodeset: hotstack-image-vexxhost
    description: |
      Hotstack scenario: 3-nodes
    timeout: 10800
    attempts: 1
    vars:
      cloud_name: vexxhost
      scenario: 3-nodes
      scenario_dir: >-
        {{
          [
            ansible_user_dir,
            zuul.projects['github.com/openstack-k8s-operators/hotstack'].src_dir,
            'scenarios'
          ] | ansible.builtin.path_join
        }}
      hotstack_overrides:
        stack_parameters:
          dns_servers:
            - 199.204.44.24
            - 199.204.47.54
          ntp_servers: []
          router_external_network: public
          floating_ip_network: public
          controller_params:
            image: hotstack-controller
            # vpu: 1 ram 2GB disk: 20GB
            flavor: ci.m1.small
          ocp_master_params:
            image: ipxe-boot-usb
            # vpu: 16 ram 48GB disk: 200GB
            flavor: 16vcpu_48GB
          ocp_worker_params:
            image: ipxe-boot-usb
            # vpu: 12 ram 32GB disk: 200GB
            flavor: 12vcpu_32GB
          compute_params:
            image: cs9stream-genericcloud
            # vpu: 2 ram 4GB disk: 40GB
            flavor: ci.m1.medium
          networker_params:
            image: cs9stream-genericcloud
            # vpu: 2 ram 4GB disk: 40GB
            flavor: ci.m1.medium
          bmh_params:
            image: cs9stream-genericcloud
            cd_image: sushy-tools-blank-image
            # vpu: 2 ram 4GB disk: 40GB
            flavor: ci.m1.medium
          ironic_params:
            image: cs9stream-genericcloud
            cd_image: sushy-tools-blank-image
            # vpu: 1 ram 2GB disk: 20GB
            flavor: ci.m1.small
    run:
      - ci/playbooks/run-deploy.yml
      - ci/playbooks/run-tests.yml
    files:
      - ^scenarios/3-nodes/.*
      - ^roles/.*

- job:
    name: vexxhost-hotstack-3-nodes-update
    parent: base-hotstack
    nodeset: hotstack-image-vexxhost
    description: |
      Hotstack scenario: 3-nodes
    timeout: 10800
    attempts: 1
    vars:
      cloud_name: vexxhost
      scenario: 3-nodes
      scenario_dir: >-
        {{
          [
            ansible_user_dir,
            zuul.projects['github.com/openstack-k8s-operators/hotstack'].src_dir,
            'scenarios'
          ] | ansible.builtin.path_join
        }}
      openstack_operators_update: true
      openstack_update: true
      openstack_operators_image: quay.io/openstack-k8s-operators/openstack-operator-index-upgrade:latest
      openstack_operator_channel: alpha
      openstack_operator_starting_csv: v0.4.0
      hotstack_overrides:
        stack_parameters:
          dns_servers:
            - 199.204.44.24
            - 199.204.47.54
          ntp_servers: []
          router_external_network: public
          floating_ip_network: public
          controller_params:
            image: hotstack-controller
            # vpu: 1 ram 2GB disk: 20GB
            flavor: ci.m1.small
          ocp_master_params:
            image: ipxe-boot-usb
            # vpu: 16 ram 48GB disk: 200GB
            flavor: 16vcpu_48GB
          ocp_worker_params:
            image: ipxe-boot-usb
            # vpu: 12 ram 32GB disk: 200GB
            flavor: 12vcpu_32GB
          compute_params:
            image: cs9stream-genericcloud
            # vpu: 2 ram 4GB disk: 40GB
            flavor: ci.m1.medium
          networker_params:
            image: cs9stream-genericcloud
            # vpu: 2 ram 4GB disk: 40GB
            flavor: ci.m1.medium
          bmh_params:
            image: cs9stream-genericcloud
            cd_image: sushy-tools-blank-image
            # vpu: 2 ram 4GB disk: 40GB
            flavor: ci.m1.medium
          ironic_params:
            image: cs9stream-genericcloud
            cd_image: sushy-tools-blank-image
            # vpu: 1 ram 2GB disk: 20GB
            flavor: ci.m1.small
    run:
      - ci/playbooks/run-deploy.yml
      - ci/playbooks/run-tests.yml
    files:
      - ^scenarios/3-nodes/.*

- job:
    name: vexxhost-hotstack-multi-nodeset
    parent: base-hotstack
    nodeset: hotstack-image-vexxhost
    description: |
      Hotstack scenario: multi-nodeset
    timeout: 10800
    attempts: 1
    vars:
      cloud_name: vexxhost
      scenario: multi-nodeset
      scenario_dir: >-
        {{
          [
            ansible_user_dir,
            zuul.projects['github.com/openstack-k8s-operators/hotstack'].src_dir,
            'scenarios'
          ] | ansible.builtin.path_join
        }}
      hotstack_overrides:
        stack_parameters:
          dns_servers:
            - 199.204.44.24
            - 199.204.47.54
          ntp_servers: []
          router_external_network: public
          floating_ip_network: public
          controller_params:
            image: hotstack-controller
            # vpu: 1 ram 2GB disk: 20GB
            flavor: ci.m1.small
          ocp_master_params:
            image: ipxe-boot-usb
            # vpu: 16 ram 48GB disk: 200GB
            flavor: 16vcpu_48GB
          ocp_worker_params:
            image: ipxe-boot-usb
            # vpu: 12 ram 32GB disk: 200GB
            flavor: 12vcpu_32GB
          compute_params:
            image: cs9stream-genericcloud
            # vpu: 2 ram 4GB disk: 40GB
            flavor: ci.m1.medium
          networker_params:
            image: cs9stream-genericcloud
            # vpu: 2 ram 4GB disk: 40GB
            flavor: ci.m1.medium
          bmh_params:
            image: sushy-tools-blank-image
            cd_image: sushy-tools-blank-image
            # vpu: 2 ram 4GB disk: 40GB
            flavor: ci.m1.medium
          ironic_params:
            image: sushy-tools-blank-image
            cd_image: sushy-tools-blank-image
            # vpu: 1 ram 2GB disk: 20GB
            flavor: ci.m1.small
          cdrom_disk_bus: sata
    run:
      - ci/playbooks/run-deploy.yml
      - ci/playbooks/run-tests.yml
    files:
      - ^scenarios/multi-nodeset/.*
